class TTB{constructor(){this.VERSION="0.0.1",this.defaultStyles={".ttb-flex":["display: flex","flex-wrap: wrap"],".ttb-modal":["position: fixed","display: flex","flex-wrap: nowrap","align-items: center","justify-content: center","background: rgba(0, 0, 0, 0.2)","top: 0","left: 0","width: 100vw","height: 100vh","z-index: 999999","opacity: 0","transition: opacity 200ms linear 0s"],".ttb-modal.show":["opacity: 1"],".ttb-notification":["display: flex","flex-wrap: nowrap","flex-direction: column;","justify-content: center;","align-items: flex-start;","transform: translate(100%, -100%)","height: 0","min-height: 0","padding: 0px","margin-bottom: 0px","min-width: 256px","min-height: 64px","box-sizing: border-sizing","border: 1px solid rgba(0, 0, 0, 0.1);","border-radius: 4px","transition: transform 200ms linear 0s, height 200ms linear 0s, min-height 200ms linear 0s, margin-bottom 200ms linear 0s, padding 200ms linear 0s"],".ttb-notification:hover":"cursor: pointer",".ttb-notification.show":["transform: translate(0%, 0%)","min-height: 64px","height: 64px","padding: 16px","margin-bottom: 16px"],".ttb-notifications":["position: fixed","top: 0","left: calc(100vw - 256px)","z-index: 10000000"]},this.websockets=[],this.documentStyle=document.createElement("style"),this.styles=[],this.set_styles(this.defaultStyles),document.head.append(this.documentStyle),window.addEventListener("beforeunload",(()=>{this.websockets.forEach((t=>t.object.close()))})),this._flexes=[],this._modal=new TTBModal,this._notifications=new TTBNotificationManager,this._response_handlers={},g_TTB=this}init(){this._notifications.init()}getModal(){return this._modal}addFlex(t){this._flexes.push(t)}resizeFlex(t){for(const e of this._flexes)t.base!=e.base&&e.update(!1)}createFlex(){return new TTBElementFlex}createElement(t){return new TTBElement(t)}_getResponseHandler(t,e){return t in e?e[t]:this._response_handlers[t]}setResponseHandler(t){this._response_handlers=t}request(t={}){const e=t.method||"GET",s=t.path||"/",i=t.headers||{},r=!1!==t.async,n=t.username||null,a=t.password||null,h=t.responseType||"text",o=(...t)=>this._getResponseHandler(...t);let l=new XMLHttpRequest;l.open(e,s,r,n,a);for(const t in i)l.setRequestHeader(t,i[t]);return l.responseType=h,l=t.xhr&&t.xhr(l)||l,new Promise(((e,s)=>{var i;l.onload=()=>{l.status>=200&&l.status<300?((i=o("success",t))&&i(l),e(l.response)):((i=o("error",t))&&i(l),s(l))},l.onerror=()=>{(i=o("error",t))&&i(l),s(new Error("Network Error"))},l.send(t.data||null)}))}websocket(t,e={}){return new WebSocketClient(t,e)}set_styles=t=>{for(const e in t)this.set_style(e,t[e])};set_style=(t,e)=>{Array.isArray(e)&&(e=e.join(";"));const s=`${t} { ${e} }`;if(this.styles.includes(s))return;const i=document.createTextNode(s),r=this.documentStyle.sheet;if(r)try{r.insertRule(s,r.cssRules.length)}catch(t){this.documentStyle.appendChild(i)}else this.documentStyle.appendChild(i);this.styles.push(s)};calculateBytes(t){let e;return e="string"==typeof t?(new TextEncoder).encode(t).byteLength:t instanceof ArrayBuffer||t instanceof DataView||t instanceof Uint8Array?t.byteLength:t instanceof Blob?t.size:t instanceof BytesBuffer?t.len():(new TextEncoder).encode(String(t)).byteLength,e}sum(...t){let e=0;for(const s of t)e+=s;return e}avg(...t){return 0==t.length?0:this.sum(...t)/t.length}isDOM(t){return t instanceof HTMLElement||"[object HTMLUnknownElement]"===Object.prototype.toString.call(t)||t&&"object"==typeof t&&1===t.nodeType&&"string"==typeof t.nodeName}collectionSingleList(...t){var e=[];for(const s of t)Array.isArray(s)?e.push(...this.collectionSingleList(...s)):e.push(s);return e}getURLParams(){return-1!==window.location.hash.indexOf("#")?window.location.hash.slice(1):""}getURLKey(){var t=this.getURLParams();return(t.startsWith("/")?t.slice(1):t).slice(0,-1!==t.indexOf("?")?t.indexOf("?"):t.length)}getURLKeyParams(){var t=this.getURLParams();if(-1!==(t=t.startsWith("/")?t.slice(1):t).indexOf("?")){for(var e={},s=t.slice(t.indexOf("?")).substring(1).split("&"),i=0;i<s.length;i++){var r=s[i].split("=");r[0]&&(e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]||""))}return e}return{}}getURLSearch(t=null){var e=null!=t?t:window.location.search;if(-1!==e.indexOf("?")){for(var s={},i=e.slice(e.indexOf("?")).substring(1).split("&"),r=0;r<i.length;r++){var n=i[r].split("=");n[0]&&(s[decodeURIComponent(n[0])]=decodeURIComponent(n[1]||""))}return s}}setURLSearch(t){var e="?";for(k in t)v=t[k],v&&(e+=encodeURIComponent(k)+"="+encodeURIComponent(v)+"&");return e.slice(0,e.length-1)}getTimestamp(t){return(t||new Date).valueOf()}getTime(t){return this.getTimestamp(t)/1e3}clamp(t,e,s){return Math.max(t,Math.min(e,s))}runTaskLater(t,e,...s){return new Task(t,e,null,...s)}runTaskRepeat(t,e,s,...i){return new Task(t,e,s,...i)}createNotication(t,e,s,i){return this._notifications.show(new TTBNotification(t,e,s,i))}randomUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}}class TTBElement{constructor(t,e=!1){this.base=e?t:document.createElement(t),this._resize_handler=[],window.addEventListener("resize",((...t)=>this._resize(...t)))}setHTML(t){return this.base.innerHTML=t,this}setText(t){return this.base.innerText=t,this}setValue(t){return this.base.value=t,this}title(t){return this.setText(t)}html(t){return this.setHTML(t)}append(...t){for(const e of t)e instanceof TTBElement?this.base.append(e.valueOf()):this.base.append(e);return this}id(t){return this.base.id=t,this}class(...t){for(const e of t)for(const t of e.split(" "))this.base.classList.add(t);return this}toggle(t){return this.base.classList.toggle(t),this}style(t){return this.base.style=t,this}_resize(...t){for(const e of this._resize_handler)try{e(...t)}catch(t){console.log(t,e)}}setStyle(t,e){return this.base.style[t]=e,this}valueOf(){return this.base}containsClass(...t){for(const e of t)for(const t of e.split(" "))if(this.base.classList.contains(t))return!0;return!1}setAttribute(t,e){return this.base.setAttribute(t,e),this}isDOM(t){return t instanceof HTMLElement||"[object HTMLUnknownElement]"===Object.prototype.toString.call(t)||t&&"object"==typeof t&&1===t.nodeType&&"string"==typeof t.nodeName}clear(){for(;null!=this.base.firstChild;)this.base.removeChild(this.base.firstChild);return this}event(t,e){return"resize"==t?(this._resize_handler.push(e),this):(this.base.addEventListener(t,e),this)}getChildrens(){return new Array(...this.base.children).map((t=>(this.isDOM(t)&&t.classList.contains("ttb-flex")&&g_TTB._flexes.filter((e=>e.valueOf()==t))[0],new TTBElement(t,!0))))}}class TTBElementFlex extends TTBElement{constructor(t="div",e=!1){super(t,e),g_TTB.addFlex(this),this.class("ttb-flex"),this._minwidth=null,this._minheight=null,this._maxwidth=null,this._maxheight=null,this._updateTimer=null,this._child=1,this._childStyle="",this._tag=null,this._resizes=[],this._disable=!1,this.update()}disable(){return this._disable=!0,this}addResize(t){return this._resizes.push(t),this}append(...t){return super.append(...t.map((t=>this.isDOM(t)||t instanceof TTBElement?t:new TTBElement("div").setHTML(t)))),this}tag(t){return this._tag=t,this}min_width(t){return this.minwidth=t,this}max_width(t){return this.maxwidth=t,this}min_height(t){return this.minheight=t,this}max_height(t){return this.maxheight=t,this}height(t){return this.setStyle("height",t),this}width(t){return this.setStyle("width",t),this}style(t,e){return g_TTB.set_style(".ttb-flex."+t+"_"+e,`${t}: ${e}`),this.class(t+"_"+e),this}update(t=!0){if(this._disable)return this;const e=super.valueOf().offsetWidth-1;let s=this._calcValueWithDisplay(this._minwidth||0,e),i=this._calcValueWithDisplay(this._maxwidth,e),r=2*Number.parseInt(g_TTB.clamp(s,e,i)/2);const n=Math.max(0,Math.floor((r-1)/this._child));for(const t of this.getChildrens()){const i=window.getComputedStyle(t.valueOf()),a=parseInt(i.marginRight,10)+parseInt(i.marginLeft,10);t.valueOf().style=this._childStyle,t.setStyle("boxSizing","border-box"),t.setStyle("width",(r<=s?e:n-(Number.isNaN(a)?0:a))+"px")}for(const t of this._resizes)t();return t?(g_TTB.resizeFlex(t),this):this}_calcValueWithDisplay(t,e){return-1==t||null==t?e:"string"==typeof t&&t.includes("%")?Math.floor(e*(parseFloat(t.replace("%",""))/100)):t}childStyle(t){return this._childStyle=t,this}minWidth(t){return this._minwidth=t,this}minHeight(t){return this._minheight=t,this}maxWidth(t){return this._maxwidth=t,this}maxHeight(t){return this._maxheight=t,this}child(t){return this._child=Math.max(1,Number.parseInt(t.toString())),this}}class TTBModal extends TTBElement{constructor(){super("div"),this._thenClose=()=>{},this.class("ttb-modal"),this.event("click",(t=>{t.target==this.valueOf()&&this._thenClose&&this._thenClose(t)})),this._close=!0,this._task=null}thenClose(t){return this._thenClose=t,this}open(...t){return this._task?.block(),this.append(...t),document.body.appendChild(this.valueOf()),document.body.style.overflow="hidden",this._close=!1,this._task=g_TTB.runTaskLater((()=>this.class("show")),50),this}close(){return this._close||(this.base.classList.remove("show"),this._task?.block(),this._task=g_TTB.runTaskLater((()=>this._real_close()),200)),this}_real_close(){for(;null!=this.valueOf().firstChild;)this.valueOf().removeChild(this.valueOf().firstChild);document.body.style.overflow="",document.body.removeChild(this.valueOf()),window.dispatchEvent(new Event("resize"))}}class TTBNotification extends TTBElement{constructor(t,e,s,i){super("div"),this._type=t,this._title=s,this._content=i,this.class("ttb-notification"),this.setStyle("background-color",e||("warn"==t?"error"==t?"#FF3D71":"#FFAA00":"#FFFFFF")),this.append(s||"",i||""),this.id(g_TTB.randomUUID())}}class TTBNotificationManager extends TTBElement{constructor(){super("div"),this.class("ttb-notifications"),this._tasks={}}init(){document.body.appendChild(this.valueOf())}show(t){return t.valueOf().id in this._tasks&&clearTimeout(this._tasks[t.valueOf().id]),this.valueOf().prepend(t.valueOf()),this._tasks[t.valueOf().id]=setTimeout((()=>{t.class("show"),this._tasks[t.valueOf().id]=setTimeout((()=>{t.base.classList.remove("show"),this._tasks[t.valueOf().id]=setTimeout((()=>this.remove(t)),200)}),5e3)}),50),t.event("click",(()=>{clearTimeout(this._tasks[t.valueOf().id]),t.base.classList.remove("show"),this._tasks[t.valueOf().id]=setTimeout((()=>this.remove(t)),200)})),t}remove(t){clearTimeout(this._tasks[t.valueOf().id]),this.base.removeChild(t.valueOf()),delete this._tasks[t.valueOf().id]}}class Task{constructor(t,e,s=null,...i){this.func=t,this.args=i,this.delay=e,this.interval=s,this._task=setTimeout((()=>this._run()),e)}_run(){try{this.func(...this.args)}catch(t){console.error(...t)}null!=this.interval&&(this._task=setTimeout((()=>this._run()),this.interval))}block(){null!=this._task&&clearTimeout(this._task),this._task=null}}class WebSocketClient{constructor(t,e={}){this.url=t,this.ws=null,this.reconnectInterval=1e3,this.messageQueue=[],this.handlers=e,this.stats={sent:{count:0,length:0},received:{count:0,length:0}},this.connect(),this.reconnectTask=null}close(){this.ws.close()}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=()=>{for(null!==this.reconnectTask&&(clearInterval(this.reconnectTask),this.reconnectTask=null);this.messageQueue.length>0;){let t=this.messageQueue.shift();this.send(t)}this.handlers.onopen&&this.handlers.onopen()},this.ws.onmessage=t=>{this.stats.received.count++,this.stats.received.length+=t.data.length,this.handlers.onmessage&&this.handlers.onmessage(t)},this.ws.onclose=()=>{this.ws=null,this.connect(),this.handlers.onclose&&this.handlers.onclose()}}send(t){this.ws&&this.ws.readyState===WebSocket.OPEN?(this.stats.sent.count++,this.stats.sent.length+=g_TTB.calculateBytes(t),this.ws.send(t instanceof BytesBuffer?t.toBytes():t)):(this.ws&&this.ws.readyState!==WebSocket.CLOSED||this.connect(),this.messageQueue.push(t))}getStats(){return this.stats}}class MinecraftUtils{static getVarInt(t){let e=[];for(;;){if(0==(4294967168&t)){e.push(t);break}e.push(127&t|128),t>>=7}return e}static getVarIntLength(t){return this.getVarInt(t).length}}class BytesBuffer{constructor(...t){this.buffer=[],this.cur=0,this.write(...t)}write(...t){for(const e of t)if(e instanceof BytesBuffer)this.buffer.push(...e.buffer);else if(Number.isInteger(e))this.buffer.push(e<0?e+256:e);else if(Array.isArray(e)&&e.filter((t=>Number.isInteger(t))).length==e.length)e.forEach((t=>this.write(t)));else if(e instanceof Uint8Array)for(let t=0;t<e.byteLength;t++)this.write(e[t]);else e instanceof ArrayBuffer?this.write(new Uint8Array(e)):void 0===!e&&console.log(typeof e,"buf",e)}read(t=1){let e=[];for(let s=0;s<t;s++)e.push(...this.buffer.slice(this.cur+s,this.cur+s+1));return this.cur+=t,e}tell(){return this.cur}readBytes(t){return this.read(t)}sizeof(){return this.buffer.length}len(){return this.buffer.length}toBytes(){return new Uint8Array(this.buffer)}copy(){let t=[];return this.buffer.forEach((e=>t.push(e))),t}}class DataOutputStream extends BytesBuffer{constructor(t){super(),this.write(t)}writeInteger(t){this.write(t>>24&255,t>>16&255,t>>8&255,t>>0&255)}writeBoolean(t){this.write(t?1:0)}writeFloat(t){const e=new Uint8Array(new Float32Array([t]).buffer);for(let t=0;t<4;t++)this.write(e[t])}writeDouble(t){const e=new Uint8Array(new Float64Array([t]).buffer);for(let t=0;t<8;t++)this.write(e[t])}writeVarInt(t){return this.write(MinecraftUtils.getVarInt(t)),this}writeString(t,e="utf-8"){return this.writeVarInt(t.length),this.write(new TextEncoder(e).encode(t)),this}writeLong(t){return t-=t>Math.pow(2,63)-1?Math.pow(2,64):t,this.write(t>>56&255,t>>48&255,t>>40&255,t>>32&255,t>>24&255,t>>16&255,t>>8&255,t>>0&255),this}writeUUID(t){return this.writeLong(t.int>>64),this.writeLong(0&t.int),this}}class DataInputStream extends BytesBuffer{readInteger(){let t=this.read(4);return(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+(t[3]<<0)}readBoolean(){return Boolean(this.read(1)[0])}readShort(){if(value=this.read(2),value[0]|value[1]<0)throw EOFError();return(value[0]<<8)+(value[1]<<0)}readLong(){let t=this.read(8);return t=(t[0]<<56)+((255&t[1])<<48)+((255&t[2])<<40)+((255&t[3])<<32)+((255&t[4])<<24)+((255&t[5])<<16)+((255&t[6])<<8)+((255&t[7])<<0),t<BigInt(Math.pow(2,63)-1)?t:t-BigInt(Math.pow(2,64))}readDouble(){return new DataView(new Uint8Array(this.readBytes(4))).getFloat64()}readFloat(){return new DataView(new Uint8Array(this.readBytes(4))).getFloat32()}readVarInt(){let t,e=0,s=0;for(;;){if(t=this.read(1)[0],e|=(127&t)<<7*s,s+=1)if(128!=(128&t))break}return e>=2**31-1?e-2**31*2:e}readString(t=null,e="utf-8"){return new TextDecoder(e).decode(new Uint8Array(this.read(null==t?this.readVarInt():t)))}readBytes(t){return this.read(t)}readUUID(){let t=this.readLong(),e=this.readLong();return new UUID(t.toBytes().concat(e.toBytes()))}}g_TTB=null;
